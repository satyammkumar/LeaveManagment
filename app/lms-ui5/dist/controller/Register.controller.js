sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/BusyIndicator"],function(e,s,t,r,o){"use strict";return e.extend("lmsui5.controller.Register",{onInit:function(){const e=new s({firstName:"",lastName:"",email:"",managerId:"",password:"",confirmPassword:""});this.getView().setModel(e,"register");const t=this.getOwnerComponent().getRouter();t.getRoute("Register").attachPatternMatched(this._onRegisterRouteMatched,this);this.getView().addEventDelegate({onAfterRendering:this._setupEnterKeyNavigation.bind(this)})},_setupEnterKeyNavigation:function(){const e=this;const s=["firstName","lastName","email","managerId","pass","confirmPassword"];s.forEach(e=>{const s=this.byId(e);if(s&&s._enterDelegate){s.removeEventDelegate(s._enterDelegate,s);s._enterDelegate=null}});const t=this.byId("Register");if(t&&t._enterDelegate){t.removeEventDelegate(t._enterDelegate,t);t._enterDelegate=null}s.forEach((t,r)=>{const o=this.byId(t);if(o){const t={onsapenter:function(){if(r<s.length-1){const t=e.byId(s[r+1]);t&&t.focus&&t.focus()}else{const s=e.byId("Register");s&&s.focus&&s.focus()}}};o.addEventDelegate(t,o);o._enterDelegate=t}});if(t){const e={onsapenter:()=>this.onRegister()};t.addEventDelegate(e,t);t._enterDelegate=e}},_onRegisterRouteMatched:function(){const e=this.getView().getModel("register");if(e){e.setData({firstName:"",lastName:"",email:"",managerId:"",password:"",confirmPassword:""})}const s=this.byId("registerMsg");s&&s.setVisible(false);const t=this.byId("firstName");t&&t.focus&&t.focus()},onBackToLogin:function(){this.getOwnerComponent().getRouter().navTo("Login")},onRegister:async function(){const e=this.getView().getModel("register");const s=e.getData();const t=this.byId("registerMsg");const a=this.byId("Register");if(!s.firstName?.trim()){this._showError(t,"Please enter first name");return}if(!s.lastName?.trim()){this._showError(t,"Please enter last name");return}if(!s.email?.trim()){this._showError(t,"Please enter email");return}const i=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!i.test(s.email)){this._showError(t,"Please enter a valid email address");return}if(!s.password?.trim()){this._showError(t,"Please enter password");return}if(s.password.length<6){this._showError(t,"Password must be at least 6 characters");return}if(s.password!==s.confirmPassword){this._showError(t,"Passwords do not match");return}if(a){a.setEnabled(false)}o.show(0);try{console.log("üì§ Submitting registration request...");console.log("üìã Registration data:",{firstName:s.firstName.trim(),lastName:s.lastName.trim(),email:s.email.trim(),managerId:s.managerId?.trim()||"",password:"***"});const a={firstName:s.firstName.trim(),lastName:s.lastName.trim(),email:s.email.trim(),password:s.password};if(s.managerId?.trim()){a.managerId=s.managerId.trim()}console.log("üìù Request body:",JSON.stringify(a,null,2));const i=await fetch("/odata/v4/my-services/register",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(a)});console.log("üì• Response status:",i.status);console.log("üì• Response headers:",i.headers);let n=null;const l=i.headers.get("content-type");try{if(l&&l.includes("application/json")){n=await i.json()}else{const e=await i.text();console.log("üì• Response text:",e);n={success:false,message:e}}}catch(e){console.error("‚ùå Error parsing response:",e);n={success:false,message:"Invalid response from server"}}console.log("üì• Parsed response:",JSON.stringify(n,null,2));if(!i.ok){const e=n?.message||n?.error?.message||"Registration failed";console.error("‚ùå Server error:",e);throw new Error(e)}if(n&&!n.success){throw new Error(n.message||"Registration failed")}console.log("‚úÖ Registration successful:",n);r.show(n?.message||"Registration successful! Redirecting to login...");e.setData({firstName:"",lastName:"",email:"",managerId:"",password:"",confirmPassword:""});if(t){t.setVisible(false)}setTimeout(()=>{o.hide();this.getOwnerComponent().getRouter().navTo("Login")},1500)}catch(e){console.error("‚ùå Registration error:",e);this._showError(t,e.message||"Registration failed. Please try again.");o.hide()}finally{if(a){a.setEnabled(true)}o.hide()}},_showError:function(e,s){if(e){e.setText(s);e.setVisible(true)}else{t.error(s)}}})});
//# sourceMappingURL=Register.controller.js.map