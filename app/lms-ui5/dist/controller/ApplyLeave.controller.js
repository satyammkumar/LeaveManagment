sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox","sap/ui/core/format/DateFormat"],function(e,t,a,n,o){"use strict";return e.extend("lmsui5.controller.ApplyLeave",{onInit:function(){var e=new t({selectedLeaveType:"",selectedDates:[],reason:"",minDate:null,maxDate:null});this.getView().setModel(e,"applyLeave");this._oDateFmt=o.getDateInstance({pattern:"yyyy-MM-dd"})},onCalendarSelect:function(){var e=this.byId("leaveCalendar");var t=e.getSelectedDates()||[];var a=[];t.forEach(function(e){var t=e.getStartDate();var n=e.getEndDate();if(t&&n){var o=new Date(t);o.setHours(0,0,0,0);var s=new Date(n);s.setHours(0,0,0,0);while(o<=s){a.push(new Date(o.getFullYear(),o.getMonth(),o.getDate()));o.setDate(o.getDate()+1)}}else if(t){var r=new Date(t.getFullYear(),t.getMonth(),t.getDate());a.push(r)}});var n={};a=a.filter(function(e){var t=e.toDateString();if(n[t])return false;n[t]=true;return true}).sort(function(e,t){return e-t});this.getView().getModel("applyLeave").setProperty("/selectedDates",a)},_toYMD:function(e){var t=e.getFullYear();var a=String(e.getMonth()+1).padStart(2,"0");var n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},_fetchLeaveTypeByCode:async function(e){const t=this.getView().getModel();const a=t.bindList("/LeaveTypes",null,null,null,{$select:"ID,code",$filter:"code eq '"+String(e).replace(/'/g,"''")+"'"});const n=await a.requestContexts(0,1);if(!n.length){throw new Error("Leave type not found for code: "+e)}const o=n[0].getObject();return{id:o.ID,code:o.code}},onSubmitLeave:async function(){const e=this.getView();const t=e.getModel("applyLeave");const o=e.getModel();const s=this.getOwnerComponent().getModel("auth");const r=t.getProperty("/selectedLeaveType");const l=t.getProperty("/selectedDates")||[];const i=t.getProperty("/reason")||"";const c=s&&s.getProperty("/user")||{};const u=c.id;const g=c.employeeID;if(!r){n.warning("Please select a leave type.");return}if(!l.length){n.warning("Please select at least one date.");return}if(!u||!g){n.error("Missing employee identity. Please log in again.");return}const d=l.slice().sort((e,t)=>e-t);const p=this._toYMD(d[0]);const y=this._toYMD(d[d.length-1]);try{const e=await this._fetchLeaveTypeByCode(r);const t={employee_ID:u,employee_employeeId:g,leaveType_ID:e.id,leaveType_code:e.code,startDate:p,endDate:y,reason:i,status:"Pending"};const n=o.bindList("/LeaveRequests");const s=n.create(t);await s.created();const l=s.getObject();const c=l&&(l.ID||l.ID_cuid||l.ID_uuid);a.show("Leave submitted successfully.");this.getOwnerComponent().getRouter().navTo("ManagerNoId")}catch(e){var v="Failed to submit leave request.";if(e&&e.message)v+="\n"+e.message;n.error(v)}},onCancelApplyLeave:function(){this.byId("applyLeaveDialog").close()}})});
//# sourceMappingURL=ApplyLeave.controller.js.map